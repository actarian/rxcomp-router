{"version":3,"sources":["www/browser/src/main.browser.ts","../../src/core/view.ts","../../src/location/location.strategy.ts","../../src/route/route-activators.ts","../../src/route/route-segment.ts","../../src/route/route.ts","../../src/route/route-path.ts","../../src/route/route-snapshot.ts","../../src/router/router-events.ts","../../src/router/router.service.ts","../../src/router/router-link.directive.ts","../../src/router/router-link-active.directive.ts","../../src/router/router-outlet.structure.ts","../../src/router.module.ts","../../src/router.types.ts","../../src/transition/transition.ts","../../www/browser/src/app.component.ts","../../www/browser/src/custom-activator/custom-activator.ts","../../www/browser/src/pages/contacts.component.ts","../../www/browser/src/pages/data.component.ts","../../www/browser/src/pages/detail.component.ts","../../www/browser/src/pages/index.component.ts","../../www/browser/src/pages/not-found.component.ts","../../www/browser/src/pages/sub.component.ts","../../www/browser/src/app.module.ts","../../www/browser/src/main.browser.ts"],"names":["rxcomp","rxjs","operators","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_defineProperty","obj","value","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","arguments","source","forEach","getOwnPropertyDescriptors","defineProperties","_inheritsLoose","subClass","superClass","create","constructor","__proto__","_arrayLikeToArray","arr","len","arr2","Array","_createForOfIteratorHelperLoose","o","allowArrayLike","it","Symbol","iterator","isArray","minLen","n","toString","call","slice","name","from","test","_unsupportedIterableToArray","done","TypeError","next","bind","View","_Component","this","_proto","onEnter","node","of","onExit","Component","LocationStrategy","serializeLink","routerLink","_this","url","map","x","encodeParams","join","serializeUrl","serialize","routePath","prefix","path","search","hash","resolve","segments","params","_step","query","_iterator","matchAll","match","g1","g2","g3","substring","split","resolveParams","routeSegments","_this2","segment","index","decodeParams","encoded","decoded","indexOf","json","window","atob","JSON","parse","error","Number","stringify","btoa","console","log","decodeSegment","s","decodeString","replace","encodeSegment","encodeString","decodeURIComponent","encodeURIComponent","getPath","getUrl","setHistory","popped","isPlatformBrowser","history","pushState","title","document","replaceState","undefined","LocationStrategyPath","_LocationStrategy","_proto2","_step2","_iterator2","LocationStrategyHash","_LocationStrategy2","_proto3","_this3","_step3","_iterator3","isPromise","Promise","makeObserver$_","callback","Observable","observer","subscription","result","isObservable","subscribe","complete","then","Error","unsubscribe","RouteSegment","Route","options","pathMatch","relative","canDeactivate","canLoad","canActivate","canActivateChild","assign","activator","component","currentRoute","route","childRoute","children","iRoute","parent","matcher","RegExp","matchers","param","regexp","RoutePath","snapshot","locationStrategy","get","url_","set","routeSegments_","RouteSnapshot","data$","ReplaySubject","params$","queryParams$","data","queryParams","RouterEvent","NavigationStart","_RouterEvent","RoutesRecognized","_RouterEvent2","GuardsCheckStart","_RouterEvent3","ChildActivationStart","_RouterEvent4","ActivationStart","_RouterEvent5","GuardsCheckEnd","_RouterEvent6","ResolveStart","_RouterEvent7","ResolveEnd","_RouterEvent8","ActivationEnd","_RouterEvent9","ChildActivationEnd","_RouterEvent10","RouteConfigLoadStart","_RouterEvent11","RouteConfigLoadEnd","_RouterEvent12","NavigationEnd","_RouterEvent13","NavigationCancel","_RouterEvent14","NavigationError","_RouterEvent15","RouterService","setRoutes","routes","observe$","makeObserve$_","route$","events$","setRouterLink","extras","trigger","navigate","findRoute","initialUrl","findRouteByUrl","resolvedRoute","getFlatRoutes_","find","urlAfterRedirects","redirectTo","lastPath","r","unshift","extractedUrl","useLocationStrategy","locationStrategyType","locationStrategy_","reduceRoutes","reduce","p","c","resolveRoutes_","childRoutes","resolveRoute_","_route$children","remainUrl","makeActivatorResponse$_","event","activators","combineLatest","pipe","values","cancelEvent","reason","stateEvents$","merge","fromEvent","location","pathname","shareReplay","switchMap","instance","makeCanDeactivateResponse$_","nextEvent","makeCanLoadResponse$_","routeActivators","reduceChildRouteActivators_","makeCanActivateChildResponse$_","makeCanActivateResponse$_","tap","_currentRoute$childre","_source$extractedUrl","_source$remainUrl","currentSnapshot","snapshots","getFlatSnapshots_","clearRoutes_","catchError","RouterLinkDirective","_Directive","getSegments","item","components","onInit","getContext","takeUntil","unsubscribe$","navigationExtras","skipLocationChange","replaceUrl","state","preventDefault","onChanges","routerLink_","setAttribute","Directive","selector","inputs","RouterLinkActiveDirective","classList","remove","isActive","routerLinkActive","add","_path$route","host","hosts","RouterOutletStructure","_Structure","route$_","_this$host$route","factory$","_this$host$route2","route_","snapshot_","_this4","_getContext","module","factory","factory_","onExit$_","element","parentNode","removeChild","meta","template","createElement","innerHTML","firstElementChild","appendChild","makeInstance","compile","onEnter$_","asObservable_","Structure","args","RouteLocationStrategy","factories","pipes","RouterModule","_Module","_this$instances","instances","pushChanges","forRoot","useStrategy","Module","transition$","declarations","concat","exports","AppComponent","errors$","customActivator","CustomActivator","ContactsComponent","DataComponent","datas","DetailComponent","_View","detailId","gsap","opacity","to","duration","ease","Power3","easeInOut","onComplete","IndexComponent","NotFoundComponent","SubComponent","AppModule","imports","CoreModule","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"\r\nimport { Component, IElement } from 'rxcomp';\r\nimport { Observable, of } from 'rxjs';\r\nimport { RouteSnapshot } from '../route/route-snapshot';\r\n\r\nexport default class View extends Component {\r\n    route!: RouteSnapshot;\r\n    onEnter(node: IElement): Observable<boolean> | Promise<boolean> | (() => boolean) | boolean { return of(true); }\r\n    onExit(node: IElement): Observable<boolean> | Promise<boolean> | (() => boolean) | boolean { return of(true); }\r\n}\r\n","import { isPlatformBrowser } from \"rxcomp\";\r\nimport { IRoutePath } from \"../route/route-path\";\r\nimport { RouterKeyValue, RouterLink } from \"../router.types\";\r\nimport { RouteSegment } from \"../rxcomp-router\";\r\n\r\nexport interface ILocationStrategy {\r\n    serializeLink(routerLink: RouterLink): string;\r\n    serializeUrl(url: string): string;\r\n    serialize(routePath: IRoutePath): string;\r\n    resolve(url: string, target: IRoutePath): IRoutePath;\r\n    resolveParams(path: string, routeSegments: RouteSegment[]): { [key: string]: any };\r\n    decodeParams(encoded: string | null): any | null;\r\n    encodeParams(value: any): string | null;\r\n    decodeSegment(s: string): string;\r\n    encodeSegment(s: string): string;\r\n    decodeString(s: string): string;\r\n    encodeString(s: string): string;\r\n    getPath(url: string): string;\r\n    getUrl(url: string, params?: URLSearchParams): string;\r\n    setHistory(url: string, params?: URLSearchParams, popped?: boolean): void;\r\n}\r\n\r\nexport class LocationStrategy implements ILocationStrategy {\r\n    serializeLink(routerLink: RouterLink): string {\r\n        const url: string = (Array.isArray(routerLink) ? routerLink : [routerLink]).map(x => {\r\n            return typeof x === 'string' ? x : this.encodeParams(x);\r\n        }).join('/');\r\n        return this.serializeUrl(url);\r\n    }\r\n    serializeUrl(url: string): string {\r\n        return url;\r\n    }\r\n    serialize(routePath: IRoutePath): string {\r\n        return `${routePath.prefix}${routePath.path}${routePath.search}${routePath.hash}`;\r\n    }\r\n    resolve(url: string, target: IRoutePath = {}): IRoutePath {\r\n        let prefix: string = '';\r\n        let path: string = '';\r\n        let query: string = '';\r\n        let search: string = '';\r\n        let hash: string = '';\r\n        let segments: string[];\r\n        let params: { [key: string]: any };\r\n        const regExp: RegExp = /^([^\\?|\\#]*)?(\\?[^\\#]*)?(\\#[^\\#]*?)?$/gm;\r\n        const matches = url.matchAll(regExp);\r\n        for (let match of matches) {\r\n            const g1 = match[1];\r\n            const g2 = match[2];\r\n            const g3 = match[3];\r\n            if (g1) {\r\n                path = g1;\r\n            }\r\n            if (g2) {\r\n                query = g2;\r\n            }\r\n            if (g3) {\r\n                hash = g3;\r\n            }\r\n        }\r\n        prefix = prefix;\r\n        path = path;\r\n        query = query;\r\n        hash = hash.substring(1, hash.length);\r\n        search = query.substring(1, query.length);\r\n        segments = path.split('/').filter(x => x !== '');\r\n        params = {};\r\n        target.prefix = prefix;\r\n        target.path = path;\r\n        target.query = query;\r\n        target.hash = hash;\r\n        target.search = search;\r\n        target.segments = segments;\r\n        target.params = params;\r\n        // console.log('resolvePath_', url, prefix, path, query, search, hash, segments, params);\r\n        return target;\r\n    }\r\n    resolveParams(path: string, routeSegments: RouteSegment[]): { [key: string]: any } {\r\n        const segments: string[] = path.split('/').filter(x => x !== '');\r\n        const params: RouterKeyValue = {};\r\n        routeSegments.forEach((segment: RouteSegment, index: number) => {\r\n            // console.log('segment.params', segment.params);\r\n            const keys: string[] = Object.keys(segment.params);\r\n            if (keys.length) {\r\n                params[keys[0]] = this.decodeParams(segments[index]);\r\n            }\r\n        });\r\n        return params;\r\n    }\r\n    decodeParams(encoded: string | null = null): any | null {\r\n        let decoded: any | null = encoded;\r\n        if (encoded) {\r\n            if (encoded.indexOf(';') === 0) {\r\n                try {\r\n                    const json = window.atob(encoded.substring(1, encoded.length));\r\n                    // const json = encoded;\r\n                    decoded = JSON.parse(json);\r\n                } catch (error) {\r\n                    // console.log('decodeParam_.error', error);\r\n                    decoded = encoded;\r\n                }\r\n            } else if (Number(encoded).toString() === encoded) {\r\n                decoded = Number(encoded);\r\n            }\r\n        }\r\n        return decoded;\r\n    }\r\n    encodeParams(value: any): string | null {\r\n        let encoded: string | null = null;\r\n        try {\r\n            if (typeof value === 'object') {\r\n                const json = JSON.stringify(value);\r\n                encoded = ';' + window.btoa(json);\r\n                // encoded = json;\r\n            } else if (typeof value === 'number') {\r\n                encoded = value.toString();\r\n            }\r\n        } catch (error) {\r\n            console.log('encodeParam__.error', error);\r\n        }\r\n        return encoded;\r\n    }\r\n    decodeSegment(s: string): string {\r\n        return this.decodeString(s.replace(/%28/g, '(').replace(/%29/g, ')').replace(/\\&/gi, '%26'));\r\n    }\r\n    encodeSegment(s: string): string {\r\n        return this.encodeString(s).replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/%26/gi, '&');\r\n    }\r\n    decodeString(s: string): string {\r\n        return decodeURIComponent(s.replace(/\\@/g, '%40').replace(/\\:/gi, '%3A').replace(/\\$/g, '%24').replace(/\\,/gi, '%2C'));\r\n    }\r\n    encodeString(s: string): string {\r\n        return encodeURIComponent(s).replace(/%40/g, '@').replace(/%3A/gi, ':').replace(/%24/g, '$').replace(/%2C/gi, ',');\r\n    }\r\n    getPath(url: string): string {\r\n        return url;\r\n    }\r\n    getUrl(url: string, params?: URLSearchParams): string {\r\n        return `${url}${params ? '?' + params.toString() : ''}`;\r\n    }\r\n    setHistory(url: string, params?: URLSearchParams, popped?: boolean): void {\r\n        if (isPlatformBrowser && window.history && window.history.pushState) {\r\n            const title = document.title;\r\n            url = this.getUrl(url, params);\r\n            // !!!\r\n            // const state = params ? params.toString() : '';\r\n            // console.log(state);\r\n            if (popped) {\r\n                window.history.replaceState(undefined, title, url);\r\n            } else {\r\n                window.history.pushState(undefined, title, url);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class LocationStrategyPath extends LocationStrategy implements ILocationStrategy {\r\n    constructor() {\r\n        super();\r\n    }\r\n    serialize(routePath: IRoutePath): string {\r\n        return `${routePath.prefix}${routePath.path}${routePath.search}${routePath.hash}`;\r\n    }\r\n    resolve(url: string, target: IRoutePath = {}): IRoutePath {\r\n        let prefix: string = '';\r\n        let path: string = '';\r\n        let query: string = '';\r\n        let search: string = '';\r\n        let hash: string = '';\r\n        let segments: string[];\r\n        let params: { [key: string]: any };\r\n        const regExp: RegExp = /^([^\\?|\\#]*)?(\\?[^\\#]*)?(\\#[^\\#]*?)?$/gm;\r\n        const matches = url.matchAll(regExp);\r\n        for (let match of matches) {\r\n            const g1 = match[1];\r\n            const g2 = match[2];\r\n            const g3 = match[3];\r\n            if (g1) {\r\n                path = g1;\r\n            }\r\n            if (g2) {\r\n                query = g2;\r\n            }\r\n            if (g3) {\r\n                hash = g3;\r\n            }\r\n        }\r\n        prefix = prefix;\r\n        path = path;\r\n        query = query;\r\n        hash = hash.substring(1, hash.length);\r\n        search = query.substring(1, query.length);\r\n        segments = path.split('/').filter(x => x !== '');\r\n        params = {};\r\n        target.prefix = prefix;\r\n        target.path = path;\r\n        target.query = query;\r\n        target.hash = hash;\r\n        target.search = search;\r\n        target.segments = segments;\r\n        target.params = params;\r\n        // console.log('resolvePath_', url, prefix, path, query, search, hash, segments, params);\r\n        return target;\r\n    }\r\n}\r\n\r\nexport class LocationStrategyHash extends LocationStrategy implements ILocationStrategy {\r\n    constructor() {\r\n        super();\r\n    }\r\n    serializeLink(routerLink: RouterLink): string {\r\n        const url: string = (Array.isArray(routerLink) ? routerLink : [routerLink]).map(x => {\r\n            return typeof x === 'string' ? x : this.encodeParams(x);\r\n        }).join('/');\r\n        return this.serializeUrl(url);\r\n    }\r\n    serializeUrl(url: string): string {\r\n        const path: IRoutePath = this.resolve(url, {});\r\n        return this.serialize(path);\r\n    }\r\n    serialize(routePath: IRoutePath): string {\r\n        return `${routePath.prefix}${routePath.search}${routePath.hash}${routePath.path}`;\r\n    }\r\n    resolve(url: string, target: IRoutePath = {}): IRoutePath {\r\n        let prefix: string = '';\r\n        let path: string = '';\r\n        let query: string = '';\r\n        let search: string = '';\r\n        let hash: string = '#';\r\n        let segments: string[];\r\n        let params: { [key: string]: any };\r\n        const regExp: RegExp = /^([^\\?|\\#]*)?(\\?[^\\#]*)?(\\#.*)$/gm;\r\n        const matches = url.matchAll(regExp);\r\n        for (let match of matches) {\r\n            const g1 = match[1];\r\n            const g2 = match[2];\r\n            const g3 = match[3];\r\n            if (g1) {\r\n                prefix = g1;\r\n            }\r\n            if (g2) {\r\n                query = g2;\r\n            }\r\n            if (g3) {\r\n                path = g3;\r\n            }\r\n        }\r\n        prefix = prefix;\r\n        path = path.substring(1, path.length);\r\n        hash = hash;\r\n        search = query.substring(1, query.length);\r\n        segments = path.split('/').filter(x => x !== '');\r\n        params = {};\r\n        target.prefix = prefix;\r\n        target.path = path;\r\n        target.query = query;\r\n        target.hash = hash;\r\n        target.search = search;\r\n        target.segments = segments;\r\n        target.params = params;\r\n        // console.log('resolvePath_', url, prefix, path, query, search, hash, segments, params);\r\n        return target;\r\n    }\r\n    getPath(url: string): string {\r\n        if (url.indexOf(`/#`) === -1) {\r\n            return `/#${url}`;\r\n        } else {\r\n            return url;\r\n        }\r\n    }\r\n    getUrl(url: string, params?: URLSearchParams): string {\r\n        return `${params ? '?' + params.toString() : ''}${this.getPath(url)}`;\r\n    }\r\n}\r\n","import { isObservable, Observable, Observer, Subscription } from 'rxjs';\r\nimport { RouteComponent, RouterActivatorResult } from '../router.types';\r\nimport { RouteSegment } from './route-segment';\r\nimport { RouteSnapshot } from './route-snapshot';\r\n\r\nexport interface ICanDeactivate<T> {\r\n    canDeactivate(component: T, currentRoute: RouteSnapshot): RouterActivatorResult\r\n}\r\n\r\nexport interface ICanLoad {\r\n    canLoad(route: RouteSnapshot, segments: RouteSegment[]): RouterActivatorResult\r\n}\r\n\r\nexport interface ICanActivate {\r\n    canActivate(route: RouteSnapshot): RouterActivatorResult\r\n}\r\n\r\nexport interface ICanActivateChild {\r\n    canActivateChild(childRoute: RouteSnapshot): RouterActivatorResult\r\n}\r\n\r\nexport function mapCanDeactivate$_<T>(activator: ICanDeactivate<T>): (component: T, currentRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]> {\r\n    return function canDeactivate$(component: T, currentRoute: RouteSnapshot): Observable<boolean | RouteComponent[]> {\r\n        return makeObserver$_(() => activator.canDeactivate(component, currentRoute));\r\n    };\r\n}\r\nexport function mapCanLoad$_(activator: ICanLoad): (route: RouteSnapshot, segments: RouteSegment[]) => Observable<boolean | RouteComponent[]> {\r\n    return function canLoad$$(route: RouteSnapshot, segments: RouteSegment[]): Observable<boolean | RouteComponent[]> {\r\n        return makeObserver$_(() => activator.canLoad(route, segments));\r\n    };\r\n}\r\nexport function mapCanActivate$_(activator: ICanActivate): (route: RouteSnapshot) => Observable<boolean | RouteComponent[]> {\r\n    return function canActivate$(route: RouteSnapshot): Observable<boolean | RouteComponent[]> {\r\n        return makeObserver$_(() => activator.canActivate(route));\r\n    };\r\n}\r\nexport function mapCanActivateChild$_(activator: ICanActivateChild): (childRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]> {\r\n    return function canActivateChild$(childRoute: RouteSnapshot): Observable<boolean | RouteComponent[]> {\r\n        return makeObserver$_(() => activator.canActivateChild(childRoute));\r\n    };\r\n}\r\nexport function isPromise<T>(object: any): object is Promise<T> {\r\n    return object instanceof Promise || (typeof object === 'object' && 'then' in object && typeof object['then'] === 'function');\r\n}\r\n\r\nfunction makeObserver$_(callback: () => RouterActivatorResult) {\r\n    return Observable.create(function (observer: Observer<boolean | RouteComponent[]>) {\r\n        let subscription: Subscription;\r\n        try {\r\n            let result: RouterActivatorResult = callback();\r\n            if (isObservable(result)) {\r\n                subscription = result.subscribe(result => {\r\n                    observer.next(result);\r\n                    observer.complete();\r\n                });\r\n            } else if (isPromise<boolean | RouteComponent[]>(result)) {\r\n                (result as Promise<boolean | RouteComponent[]>).then(result => {\r\n                    observer.next(result);\r\n                    observer.complete();\r\n                });\r\n            } else if (typeof result === 'boolean' || Array.isArray(result)) {\r\n                observer.next(result);\r\n                observer.complete();\r\n            } else {\r\n                observer.error(new Error('invalid value'));\r\n            }\r\n        } catch (error) {\r\n            observer.error(error);\r\n        }\r\n        return () => {\r\n            if (subscription) {\r\n                subscription.unsubscribe();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n","import { RouterKeyValue } from '../router.types';\r\n\r\nexport class RouteSegment {\r\n    path: string;\r\n    params: any;\r\n    constructor(path: string, params: RouterKeyValue = {}) {\r\n        this.path = path;\r\n        this.params = params;\r\n    }\r\n    /*\r\n    toString(): string {\r\n        return `${encodeSegment_(this.path)}${encodeParams_(this.params)}`;\r\n    }\r\n    */\r\n}\r\n/*\r\nexport function encodeParams_(params: RouterKeyValue): string {\r\n    // !!! array?\r\n    return Object.keys(params).map(key => `;${encodeSegment_(key)}=${typeof params[key] === 'string' ? encodeSegment_(params[key] as string) : encodeParams_(params[key] as RouterKeyValue)}`).join('');\r\n}\r\nexport function encodeSegment_(s: string): string {\r\n    return encodeString_(s).replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/%26/gi, '&');\r\n}\r\nexport function encodeString_(s: string): string {\r\n    return encodeURIComponent(s).replace(/%40/g, '@').replace(/%3A/gi, ':').replace(/%24/g, '$').replace(/%2C/gi, ',');\r\n}\r\nexport function decodeParams_(encodedParams: string): RouterKeyValue {\r\n    const params: RouterKeyValue = {} as RouterKeyValue;\r\n    const keyValues = encodedParams.split(';');\r\n    keyValues.forEach((x: string) => {\r\n        const kvs: string[] = x.split('=');\r\n        if (kvs.length === 2) {\r\n            params[kvs[0]] = kvs[1];\r\n        }\r\n    });\r\n    return params;\r\n}\r\nexport function decodeParams__<T>(encoded: string | null = null): T | null {\r\n    let decoded = null;\r\n    if (encoded) {\r\n        try {\r\n            const json = window.atob(encoded);\r\n            decoded = JSON.parse(json) as T;\r\n        } catch (error) {\r\n            console.log('decodeParam_.error', error);\r\n        }\r\n    }\r\n    return decoded;\r\n}\r\nexport function encodeParams__(value: any): string | null {\r\n    let encoded = null;\r\n    try {\r\n        const json = JSON.stringify(value);\r\n        encoded = window.btoa(json);\r\n    } catch (error) {\r\n        console.log('encodeParam__.error', error);\r\n    }\r\n    return encoded;\r\n}\r\nexport function resolveParams__(url: string, routeSegments: RouteSegment[]): RouterKeyValue {\r\n    // console.log('resolveParams__.resolvedRoute.routeSegments', routeSegments);\r\n    const path: string = url.split('?')[0];\r\n    const query: string = url.substring(path.length, url.length);\r\n    const search: string = query.split('#')[0];\r\n    const hash: string = query.substring(search.length, query.length);\r\n    const segments: string[] = path.split('/').filter(x => x !== '');\r\n    const params: RouterKeyValue = {};\r\n    routeSegments.forEach((segment: RouteSegment, index: number) => {\r\n        // console.log('segment.params', segment.params);\r\n        const keys: string[] = Object.keys(segment.params);\r\n        if (keys.length) {\r\n            params[keys[0]] = decodeParams_(segments[index]);\r\n        }\r\n    });\r\n    return params;\r\n}\r\n*/","import { Component, Factory } from 'rxcomp';\r\nimport { Observable } from 'rxjs';\r\nimport { Data, RouteComponent, RouterKeyValue } from '../router.types';\r\nimport { ICanActivate, ICanActivateChild, ICanDeactivate, ICanLoad, mapCanActivate$_, mapCanActivateChild$_, mapCanDeactivate$_, mapCanLoad$_ } from './route-activators';\r\nimport { RouteSegment } from './route-segment';\r\nimport { RouteSnapshot } from './route-snapshot';\r\n\r\nexport type IRoutes = IRoute[];\r\nexport type Routes = Route[];\r\n\r\nexport interface INavigationExtras {\r\n    relativeTo?: RouteSnapshot | null;\r\n    queryParams?: RouterKeyValue; // Params | null;\r\n    fragment?: string;\r\n    preserveQueryParams?: boolean;\r\n    queryParamsHandling?: any; // QueryParamsHandling | null;\r\n    preserveFragment?: boolean;\r\n    skipLocationChange?: boolean;\r\n    replaceUrl?: boolean;\r\n    state?: { [key: string]: any };\r\n}\r\n\r\nexport interface IBaseRoute {\r\n    path?: string;\r\n    pathMatch?: 'prefix' | 'full';\r\n    component?: typeof Component;\r\n    // matcher?: UrlMatcher;\r\n    matcher?: RegExp;\r\n    redirectTo?: string;\r\n    outlet?: string;\r\n    children?: IRoutes | Routes;\r\n    // children?: IRoute[];\r\n    initialUrl?: string;\r\n    urlAfterRedirects?: string;\r\n    extractedUrl?: string;\r\n    remainUrl?: string;\r\n    // resolve?: ResolveData;\r\n    // loadChildren?: LoadChildren;\r\n    // runGuardsAndResolvers?: RunGuardsAndResolvers;\r\n    data?: Data;\r\n    params?: RouterKeyValue;\r\n    queryParams?: RouterKeyValue;\r\n}\r\n\r\nexport interface IRoute extends IBaseRoute {\r\n    canActivate?: ICanActivate[];\r\n    canActivateChild?: ICanActivateChild[];\r\n    canDeactivate?: ICanDeactivate<Component>[];\r\n    canLoad?: ICanLoad[];\r\n}\r\n\r\nexport class Route implements IBaseRoute {\r\n    path!: string;\r\n    pathMatch: 'prefix' | 'full' = 'prefix';\r\n    component!: typeof Component; // import !!!\r\n    matcher: RegExp;\r\n    redirectTo?: string;\r\n    segments: RouteSegment[];\r\n    relative: boolean = true;\r\n    children?: Routes;\r\n    parent?: Route;\r\n    snapshot?: RouteSnapshot;\r\n    canDeactivate: ((component: Factory, currentRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canLoad: ((route: RouteSnapshot, segments: RouteSegment[]) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canActivate: ((route: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canActivateChild: ((childRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    constructor(options?: IRoute) {\r\n        if (options) {\r\n            Object.assign(this, options);\r\n            this.canDeactivate = options.canDeactivate ? options.canDeactivate.map(x => mapCanDeactivate$_<Component>(x)) : [];\r\n            this.canLoad = options.canLoad ? options.canLoad.map(x => mapCanLoad$_(x)) : [];\r\n            this.canActivate = options.canActivate ? options.canActivate.map(x => mapCanActivate$_(x)) : [];\r\n            this.canActivateChild = options.canActivateChild ? options.canActivateChild.map(x => mapCanActivateChild$_(x)) : [];\r\n        }\r\n        if (this.children) {\r\n            this.children = this.children.map((iRoute: IBaseRoute) => {\r\n                const route = new Route(iRoute);\r\n                route.parent = this;\r\n                return route;\r\n            });\r\n        }\r\n        const segments: RouteSegment[] = [];\r\n        if (this.path === '**') {\r\n            segments.push(new RouteSegment(this.path));\r\n            this.matcher = new RegExp('^.*$');\r\n        } else {\r\n            const matchers: string[] = [`^(\\.\\.\\/|\\.\\/|\\/\\/|\\/)?`];\r\n            const regExp: RegExp = /(^\\.\\.\\/|\\.\\/|\\/\\/|\\/)|([^:|\\/]+)\\/?|\\:([^\\/]+)\\/?/g;\r\n            const matches = this.path.matchAll(regExp);\r\n            for (let match of matches) {\r\n                const g1 = match[1];\r\n                const g2 = match[2];\r\n                const g3 = match[3];\r\n                if (g1) {\r\n                    this.relative = !(g1 === '//' || g1 === '/');\r\n                } else if (g2) {\r\n                    matchers.push(g2);\r\n                    segments.push(new RouteSegment(g2));\r\n                } else if (g3) {\r\n                    matchers.push('(\\/[^\\/]+)');\r\n                    const param: { [key: string]: any } = {};\r\n                    param[g3] = null;\r\n                    segments.push(new RouteSegment('', param));\r\n                }\r\n            }\r\n            if (this.pathMatch === 'full') {\r\n                matchers.push('$');\r\n            }\r\n            const regexp: string = matchers.join('');\r\n            this.matcher = new RegExp(regexp);\r\n        }\r\n        this.segments = segments;\r\n    }\r\n}\r\n","import { ILocationStrategy, LocationStrategy } from '../location/location.strategy';\r\nimport { RouterKeyValue } from '../router.types';\r\nimport { Route } from './route';\r\nimport { RouteSegment } from './route-segment';\r\n\r\nexport interface IRoutePath {\r\n    url?: string;\r\n    prefix?: string;\r\n    path?: string;\r\n    query?: string;\r\n    search?: any;\r\n    hash?: any;\r\n    params?: { [key: string]: any };\r\n    segments?: string[];\r\n}\r\n\r\nexport class RoutePath implements IRoutePath {\r\n    private url_!: string;\r\n    get url(): string {\r\n        return this.url_;\r\n    }\r\n    set url(url: string) {\r\n        // console.log(this.url_, url);\r\n        if (this.url_ !== url) {\r\n            this.locationStrategy.resolve(url, this);\r\n            // resolvePath_(url, this, this.locationStrategy);\r\n            this.url_ = this.locationStrategy.serialize(this);\r\n            // serializeUrl_(this, this.locationStrategy);\r\n            // this.url_ = url; // !!! serialize url;\r\n            // console.log('url_', this.url_);\r\n        }\r\n    }\r\n    private routeSegments_!: RouteSegment[];\r\n    get routeSegments(): RouteSegment[] {\r\n        return this.routeSegments_;\r\n    }\r\n    set routeSegments(routeSegments: RouteSegment[]) {\r\n        if (this.routeSegments_ !== routeSegments) {\r\n            this.routeSegments_ = routeSegments;\r\n            // !!! const path: string = this.locationStrategy === RouteLocationStrategy.Hash ? this.hash : this.path;\r\n            // this.params = resolveParams_(this.path, routeSegments);\r\n            this.params = this.locationStrategy.resolveParams(this.path, routeSegments);\r\n        }\r\n    }\r\n    get remainUrl(): string {\r\n        return this.query + this.hash;\r\n    }\r\n    prefix: string = '';\r\n    path: string = '';\r\n    query: string = '';\r\n    search: string = '';\r\n    hash: string = '';\r\n    params!: { [key: string]: any };\r\n    segments!: string[];\r\n    route?: Route;\r\n    locationStrategy: ILocationStrategy;\r\n    constructor(url: string = '', routeSegments: RouteSegment[] = [], snapshot?: Route, locationStrategy?: ILocationStrategy) {\r\n        this.locationStrategy = locationStrategy || new LocationStrategy();\r\n        this.url = url;\r\n        this.routeSegments = routeSegments;\r\n        this.route = snapshot;\r\n    }\r\n    /*\r\n    toString(): string {\r\n        return this.url_;\r\n        // return `${encodeSegment_(this.path)}${encodeParams_(this.params)}`;\r\n    }\r\n    */\r\n}\r\n\r\n/*\r\n\r\nexport function serializeUrl_(target: IRoutePath, locationStrategy: ILocationStrategy): string {\r\n    // return `${target.path!}${target.search}${target.hash}`;\r\n    return locationStrategy.serialize(target);\r\n}\r\n\r\n// !!! todo: resolvePath_ in LocationStrategy interface\r\n\r\nexport function resolvePath_(url: string, target: IRoutePath = {}, locationStrategy: ILocationStrategy): IRoutePath {\r\n    return locationStrategy.resolve(url, target);\r\n}\r\n\r\nexport function resolveStrategyPath_(url: string, target: IRoutePath = {}): IRoutePath {\r\n    let path: string = '';\r\n    let query: string = '';\r\n    let hash: string = '';\r\n    const regExp: RegExp = /^([^\\?|\\#]*)?(\\?[^\\#]*)?(\\#[^\\#]*?)?$/gm;\r\n    const matches = url.matchAll(regExp);\r\n    for (let match of matches) {\r\n        const g1 = match[1];\r\n        const g2 = match[2];\r\n        const g3 = match[3];\r\n        if (g1) {\r\n            path = g1;\r\n        }\r\n        if (g2) {\r\n            query = g2;\r\n        }\r\n        if (g3) {\r\n            hash = g3;\r\n        }\r\n    }\r\n    target.path = path;\r\n    target.query = query;\r\n    target.hash = hash.substring(1, hash.length);\r\n    target.search = query.substring(1, query.length);\r\n    // let search: string = target.search = query.substring(1, query.length);\r\n    // const path: string = target.path = url.split('?')[0];\r\n    // const query: string = target.query = url.substring(path.length, url.length);\r\n    // const search: string = target.search = query.split('#')[0];\r\n    // const hash: string = target.hash = query.substring(search.length, query.length);\r\n    target.segments = path.split('/').filter(x => x !== '');\r\n    target.params = {};\r\n    // console.log('resolvePath_', url, path, query, target.search, hash, target.segments, target.params);\r\n    return target;\r\n}\r\nexport function resolveStrategyHash_(url: string, target: IRoutePath = {}): IRoutePath {\r\n    let path: string = '';\r\n    let query: string = '';\r\n    let hash: string = '';\r\n    const regExp: RegExp = /^(\\/)?(\\?[^\\#]*)?(\\#.*)$/gm;\r\n    const matches = url.matchAll(regExp);\r\n    for (let match of matches) {\r\n        const g1 = match[1];\r\n        const g2 = match[2];\r\n        const g3 = match[3];\r\n        if (g1) {\r\n            path = g1;\r\n        }\r\n        if (g2) {\r\n            query = g2;\r\n        }\r\n        if (g3) {\r\n            hash = g3;\r\n        }\r\n    }\r\n    target.path = path;\r\n    target.query = query;\r\n    target.hash = hash.substring(1, hash.length);\r\n    target.search = query.substring(1, query.length);\r\n    // let search: string = target.search = query.substring(1, query.length);\r\n    // const path: string = target.path = url.split('?')[0];\r\n    // const query: string = target.query = url.substring(path.length, url.length);\r\n    // const search: string = target.search = query.split('#')[0];\r\n    // const hash: string = target.hash = query.substring(search.length, query.length);\r\n    target.segments = hash.split('/').filter(x => x !== '');\r\n    target.params = {};\r\n    // console.log('resolvePath_', url, path, query, search, hash, segments, params);\r\n    return target;\r\n}\r\n*/\r\n\r\nexport function resolveParams_(path: string, routeSegments: RouteSegment[]): { [key: string]: any } {\r\n    const segments: string[] = path.split('/').filter(x => x !== '');\r\n    const params: RouterKeyValue = {};\r\n    routeSegments.forEach((segment: RouteSegment, index: number) => {\r\n        // console.log('segment.params', segment.params);\r\n        const keys: string[] = Object.keys(segment.params);\r\n        if (keys.length) {\r\n            params[keys[0]] = decodeParams_(segments[index]);\r\n        }\r\n    });\r\n    return params;\r\n}\r\nexport function decodeParams_(encoded: string | null = null): any | null {\r\n    let decoded: any | null = encoded;\r\n    if (encoded) {\r\n        if (encoded.indexOf(';') === 0) {\r\n            try {\r\n                const json = window.atob(encoded.substring(1, encoded.length));\r\n                // const json = encoded;\r\n                decoded = JSON.parse(json);\r\n            } catch (error) {\r\n                // console.log('decodeParam_.error', error);\r\n                decoded = encoded;\r\n            }\r\n        } else if (Number(encoded).toString() === encoded) {\r\n            decoded = Number(encoded);\r\n        }\r\n    }\r\n    return decoded;\r\n}\r\nexport function encodeParams_(value: any): string | null {\r\n    let encoded: string | null = null;\r\n    try {\r\n        if (typeof value === 'object') {\r\n            const json = JSON.stringify(value);\r\n            encoded = ';' + window.btoa(json);\r\n            // encoded = json;\r\n        } else if (typeof value === 'number') {\r\n            encoded = value.toString();\r\n        }\r\n    } catch (error) {\r\n        console.log('encodeParam__.error', error);\r\n    }\r\n    return encoded;\r\n}\r\nexport function decodeSegment_(s: string): string {\r\n    return decodeString_(s.replace(/%28/g, '(').replace(/%29/g, ')').replace(/\\&/gi, '%26'));\r\n}\r\nexport function encodeSegment_(s: string): string {\r\n    return encodeString_(s).replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/%26/gi, '&');\r\n}\r\nexport function decodeString_(s: string): string {\r\n    return decodeURIComponent(s.replace(/\\@/g, '%40').replace(/\\:/gi, '%3A').replace(/\\$/g, '%24').replace(/\\,/gi, '%2C'));\r\n}\r\nexport function encodeString_(s: string): string {\r\n    return encodeURIComponent(s).replace(/%40/g, '@').replace(/%3A/gi, ':').replace(/%24/g, '$').replace(/%2C/gi, ',');\r\n}\r\n/*\r\nexport function encodeParams_(params: RouterKeyValue): string {\r\n    // !!! array?\r\n    return Object.keys(params).map(key => `;${encodeSegment_(key)}=${typeof params[key] === 'string' ? encodeSegment_(params[key] as string) : encodeParams_(params[key] as RouterKeyValue)}`).join('');\r\n}\r\nexport function decodeParams_(encodedParams: string): RouterKeyValue {\r\n    const params: RouterKeyValue = {} as RouterKeyValue;\r\n    const keyValues = encodedParams.split(';');\r\n    keyValues.forEach((x: string) => {\r\n        const kvs: string[] = x.split('=');\r\n        if (kvs.length === 2) {\r\n            params[kvs[0]] = kvs[1];\r\n        }\r\n    });\r\n    return params;\r\n}\r\nexport function resolvePath___(url: string, routeSegments: RouteSegment[]): { path: string, search: string, hash: string, segments: any[] } {\r\n    // console.log('resolvePath_.resolvedRoute.routeSegments', routeSegments);\r\n    const path: string = url.split('?')[0];\r\n    const query: string = url.substring(path.length, url.length);\r\n    const search: string = query.split('#')[0];\r\n    const hash: string = query.substring(search.length, query.length);\r\n    const segments: string[] = path.split('/').filter(x => x !== '');\r\n    const params: RouterKeyValue = {};\r\n    routeSegments.forEach((segment: RouteSegment, index: number) => {\r\n        // console.log('segment.params', segment.params);\r\n        const keys: string[] = Object.keys(segment.params);\r\n        if (keys.length) {\r\n            params[keys[0]] = decodeParams_(segments[index]);\r\n        }\r\n    });\r\n    return { path, search, hash, segments };\r\n}\r\n*/","import { Component, Factory } from 'rxcomp';\r\nimport { Observable, ReplaySubject } from 'rxjs';\r\nimport { RouteComponent, RouterKeyValue } from '../router.types';\r\nimport { IBaseRoute, Route } from './route';\r\nimport { RouteSegment } from './route-segment';\r\n\r\nexport class RouteSnapshot implements IBaseRoute {\r\n    path!: string;\r\n    pathMatch: 'prefix' | 'full' = 'prefix';\r\n    component!: typeof Component; // import !!!\r\n    redirectTo?: string;\r\n    segments!: RouteSegment[];\r\n    relative: boolean = true;\r\n    children?: Route[];\r\n    childRoute?: RouteSnapshot;\r\n    parent?: RouteSnapshot | undefined;\r\n    initialUrl?: string;\r\n    urlAfterRedirects?: string;\r\n    extractedUrl?: string;\r\n    remainUrl?: string;\r\n    data!: RouterKeyValue;\r\n    params!: RouterKeyValue;\r\n    queryParams!: RouterKeyValue;\r\n    data$: ReplaySubject<RouterKeyValue> = new ReplaySubject<RouterKeyValue>(1);\r\n    params$: ReplaySubject<RouterKeyValue> = new ReplaySubject<RouterKeyValue>(1);\r\n    queryParams$: ReplaySubject<RouterKeyValue> = new ReplaySubject<RouterKeyValue>(1);\r\n    canDeactivate: ((component: Factory, currentRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canLoad: ((route: RouteSnapshot, segments: RouteSegment[]) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canActivate: ((route: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    canActivateChild: ((childRoute: RouteSnapshot) => Observable<boolean | RouteComponent[]>)[] = [];\r\n    instance?: Component;\r\n    constructor(options?: IBaseRoute) {\r\n        if (options) {\r\n            Object.assign(this, options);\r\n        }\r\n        this.data$.next(this.data);\r\n        this.params$.next(this.params);\r\n        this.queryParams$.next(this.queryParams);\r\n    }\r\n    next(snapshot: RouteSnapshot): void {\r\n        this.childRoute = snapshot.childRoute;\r\n        if (snapshot.childRoute) {\r\n            snapshot.childRoute.parent = this;\r\n        }\r\n        const data = this.data = Object.assign({}, snapshot.data);\r\n        this.data$.next(data);\r\n        const params = this.params = Object.assign({}, snapshot.params);\r\n        this.params$.next(params);\r\n        const queryParams = this.queryParams = Object.assign({}, snapshot.queryParams);\r\n        this.queryParams$.next(queryParams);\r\n    }\r\n}","import { Route } from '../route/route';\r\nimport { RouteSnapshot } from '../route/route-snapshot';\r\nimport { RouteComponent, RouterLink } from '../router.types';\r\n\r\nexport interface IRouterEvent {\r\n    id?: number;\r\n    routerLink?: RouterLink;\r\n    url?: string; // The target URL passed into the `Router#navigateByUrl()` call before navigation. This is the value before the router has parsed or applied redirects to it.\r\n    initialUrl?: any; // string | UrlTree; // The initial target URL after being parsed with `UrlSerializer.extract()`.\r\n    urlAfterRedirects?: string;\r\n    extractedUrl?: any; // UrlTree; // The extracted URL after redirects have been applied.\r\n    remainUrl?: string;\r\n    finalUrl?: any; // UrlTree;\r\n    trigger?: 'imperative' | 'popstate' | 'hashchange';\r\n    extras?: any; // NavigationExtras;\r\n    previousNavigation?: IRouterEvent | null;\r\n    route?: Route | RouteSnapshot;\r\n    reason?: string;\r\n    redirectTo?: RouteComponent[];\r\n    error?: any;\r\n}\r\nexport class RouterEvent implements IRouterEvent {\r\n    url!: string;\r\n    routerLink!: RouterLink;\r\n    trigger!: 'imperative' | 'popstate' | 'hashchange';\r\n    constructor(options?: IRouterEvent) {\r\n        if (options) {\r\n            Object.assign(this, options);\r\n        }\r\n        if (this.routerLink) {\r\n            this.url = Array.isArray(this.routerLink) ? this.routerLink.join('') : this.routerLink;\r\n        }\r\n    }\r\n}\r\n// An event triggered when navigation starts.\r\nexport class NavigationStart extends RouterEvent {\r\n    navigationTrigger!: 'imperative' | 'popstate' | 'hashchange';\r\n    restoredState?: { [key: string]: any };\r\n}\r\n// An event triggered when the Router parses the URL and the routes are recognized.\r\nexport class RoutesRecognized extends RouterEvent {\r\n    route!: RouteSnapshot; // ???\r\n    // state!: RouterStateSnapshot;\r\n}\r\n// An event triggered at the start of the Guard phase of routing.\r\nexport class GuardsCheckStart extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the start of the child-activation part of the Resolve phase of routing.\r\nexport class ChildActivationStart extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the start of the activation part of the Resolve phase of routing.\r\nexport class ActivationStart extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the end of the Guard phase of routing.\r\nexport class GuardsCheckEnd extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the the start of the Resolve phase of routing.\r\nexport class ResolveStart extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the end of the Resolve phase of routing.\r\nexport class ResolveEnd extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the end of the activation part of the Resolve phase of routing.\r\nexport class ActivationEnd extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered at the end of the child-activation part of the Resolve phase of routing.\r\nexport class ChildActivationEnd extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered before the Router lazy loads a route configuration.\r\nexport class RouteConfigLoadStart extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n    urlAfterRedirects!: string;\r\n}\r\n// An event triggered after a route has been lazy loaded.\r\nexport class RouteConfigLoadEnd extends RouterEvent {\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered when navigation ends successfully.\r\nexport class NavigationEnd extends RouterEvent {\r\n    urlAfterRedirects!: string;\r\n    route!: RouteSnapshot;\r\n}\r\n// An event triggered when navigation is canceled. This is due to a Route Guard returning false during navigation.\r\nexport class NavigationCancel extends RouterEvent {\r\n    reason!: string;\r\n    redirectTo?: RouteComponent[];\r\n}\r\n// An event triggered when navigation fails due to an unexpected error.\r\nexport class NavigationError extends RouterEvent {\r\n    error!: any;\r\n}\r\n\r\n/*\r\nNavigationStart {id: 1, url: '/test-a', navigationTrigger: 'imperative', restoredState: null, constructor: Object}\r\nRoutesRecognized {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', state: RouterStateSnapshot, constructor: Object}\r\nGuardsCheckStart {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', state: RouterStateSnapshot, constructor: Object}\r\nChildActivationStart {snapshot: ActivatedRouteSnapshot, constructor: Object}\r\nActivationStart {snapshot: ActivatedRouteSnapshot, constructor: Object}\r\nGuardsCheckEnd {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', state: RouterStateSnapshot, shouldActivate: true}\r\nResolveStart {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', state: RouterStateSnapshot, constructor: Object}\r\nResolveEnd {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', state: RouterStateSnapshot, constructor: Object}\r\nActivationEnd {snapshot: ActivatedRouteSnapshot, constructor: Object}\r\nChildActivationEnd {snapshot: ActivatedRouteSnapshot, constructor: Object}\r\nNavigationEnd {id: 1, url: '/test-a', urlAfterRedirects: '/test-a', constructor: Object}\r\nScroll {routerEvent: NavigationEnd, position: null, anchor: null, constructor: Object}\r\n*/","import { combineLatest, fromEvent, merge, Observable, of, ReplaySubject } from 'rxjs';\r\nimport { catchError, map, shareReplay, switchMap, tap } from 'rxjs/operators';\r\nimport { ILocationStrategy, LocationStrategy, LocationStrategyPath } from '../location/location.strategy';\r\nimport { INavigationExtras, IRoute, IRoutes, Route, Routes } from '../route/route';\r\nimport { RoutePath } from '../route/route-path';\r\nimport { RouteSegment } from '../route/route-segment';\r\nimport { RouteSnapshot } from '../route/route-snapshot';\r\nimport { RouteComponent, RouterKeyValue, RouterLink } from '../router.types';\r\nimport { ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart, GuardsCheckEnd, GuardsCheckStart, IRouterEvent, NavigationCancel, NavigationEnd, NavigationError, NavigationStart, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RouterEvent, RoutesRecognized } from './router-events';\r\n\r\n// !!! todo: hash navigation strategy\r\n\r\nexport default class RouterService {\r\n    static routes: Routes = [];\r\n    static route$: ReplaySubject<RouteSnapshot> = new ReplaySubject<RouteSnapshot>(1);\r\n    static events$: ReplaySubject<RouterEvent> = new ReplaySubject<RouterEvent>(1);\r\n    static observe$: Observable<RouterEvent>;\r\n    static get flatRoutes(): Routes {\r\n        return getFlatRoutes_(this.routes);\r\n    }\r\n    static setRoutes(routes: IRoutes): RouterService {\r\n        this.routes = routes.map((x: IRoute) => new Route(x));\r\n        this.observe$ = makeObserve$_(this.routes, this.route$, this.events$, this.locationStrategy);\r\n        return this;\r\n    }\r\n    static setRouterLink(routerLink: RouterLink, extras: INavigationExtras = { skipLocationChange: false }): void {\r\n        // ['/hero', hero.id];\r\n        this.events$.next(new NavigationStart({ routerLink, trigger: 'imperative' }));\r\n    }\r\n    static navigate(routerLink: RouterLink, extras: INavigationExtras = { skipLocationChange: false }): void {\r\n        // navigate(['items'], { relativeTo: this.route });\r\n        // navigate(['/heroes', { id: heroId }]);\r\n        this.events$.next(new NavigationStart({ routerLink, trigger: 'imperative' }));\r\n    }\r\n    static findRoute(routerLink: RouterLink): Route | null {\r\n        const initialUrl: string = this.locationStrategy.serializeLink(routerLink);\r\n        return this.findRouteByUrl(initialUrl);\r\n    }\r\n    static findRouteByUrl(initialUrl: string): Route | null {\r\n        const routes: Routes = getFlatRoutes_(this.routes);\r\n        let resolvedRoute: Route | null = routes.find(route => initialUrl.match(route.matcher)) || null;\r\n        let urlAfterRedirects: string = initialUrl;\r\n        if (resolvedRoute && resolvedRoute.redirectTo) {\r\n            urlAfterRedirects = resolvedRoute.redirectTo;\r\n            resolvedRoute = this.findRouteByUrl(urlAfterRedirects);\r\n        }\r\n        return resolvedRoute;\r\n    }\r\n    static getPath(routerLink: RouterLink = []): RoutePath {\r\n        const lastPath: string = (Array.isArray(routerLink) ? routerLink : [routerLink]).map(x => {\r\n            return typeof x === 'string' ? x : this.locationStrategy.encodeParams(x);\r\n        }).join('/');\r\n        const segments: RouteSegment[] = [];\r\n        const routes: (Route | RouteSnapshot)[] = [];\r\n        const route: Route | null = this.findRouteByUrl(lastPath);\r\n        if (route) {\r\n            let r: Route | RouteSnapshot | undefined | null = route?.parent;\r\n            while (r) {\r\n                segments.unshift.apply(segments, r.segments);\r\n                routes.unshift(r instanceof RouteSnapshot ? r : r.snapshot || r);\r\n                r = r.parent;\r\n            }\r\n            segments.push.apply(segments, route?.segments || []);\r\n            routes.push({ path: lastPath } as any);\r\n        }\r\n        let initialUrl: string = routes.map(r => r instanceof RouteSnapshot ? r.extractedUrl : r.path).join('/');\r\n        initialUrl = this.locationStrategy.getPath(initialUrl);\r\n        // console.log('RouterService.getPath', initialUrl);\r\n        const routePath: RoutePath = new RoutePath(initialUrl, segments, route || undefined, this.locationStrategy);\r\n        return routePath;\r\n    }\r\n    private static locationStrategy_: ILocationStrategy;\r\n    static get locationStrategy(): ILocationStrategy {\r\n        if (this.locationStrategy_) {\r\n            return this.locationStrategy_;\r\n        } else {\r\n            return this.locationStrategy_ = new LocationStrategyPath();\r\n        }\r\n    }\r\n    static useLocationStrategy(locationStrategyType: typeof LocationStrategy): void {\r\n        this.locationStrategy_ = new locationStrategyType();\r\n    }\r\n}\r\n/*\r\nfunction setHistory_(locationStrategy: ILocationStrategy, url: string, params?: URLSearchParams, popped?: boolean): void {\r\n    if (isPlatformBrowser && window.history && window.history.pushState) {\r\n        const title = document.title;\r\n        url = locationStrategy.getUrl(url, params);\r\n        // !!!\r\n        // const state = params ? params.toString() : '';\r\n        // console.log(state);\r\n        if (popped) {\r\n            window.history.replaceState(undefined, title, url);\r\n        } else {\r\n            window.history.pushState(undefined, title, url);\r\n        }\r\n    }\r\n}\r\n*/\r\nfunction getFlatRoutes_(routes: Routes): Routes {\r\n    const reduceRoutes: (routes: Route[]) => Route[] = (routes: Route[]): Route[] => {\r\n        return routes.reduce<Routes>((p: Route[], c: Route) => {\r\n            p.push(c);\r\n            p.push.apply(p, reduceRoutes(c.children || []));\r\n            return p;\r\n        }, []);\r\n    }\r\n    return reduceRoutes(routes);\r\n}\r\nfunction getFlatSnapshots_(currentSnapshot: RouteSnapshot): RouteSnapshot[] {\r\n    let snapshots: RouteSnapshot[] = [currentSnapshot];\r\n    let childRoute: RouteSnapshot | undefined = currentSnapshot.childRoute;\r\n    while (childRoute) {\r\n        snapshots.push(childRoute)\r\n        childRoute = childRoute.childRoute;\r\n    }\r\n    return snapshots;\r\n}\r\nfunction clearRoutes_(routes: Routes, currentSnapshot: RouteSnapshot): void {\r\n    let snapshots: RouteSnapshot[] = getFlatSnapshots_(currentSnapshot);\r\n    const flatRoutes: Routes = getFlatRoutes_(routes);\r\n    flatRoutes.forEach((route: Route) => {\r\n        if (route.snapshot && snapshots.indexOf(route.snapshot) === -1) {\r\n            route.snapshot = undefined;\r\n        }\r\n    });\r\n}\r\nfunction resolveRoutes_(routes: Routes, childRoutes: Routes, initialUrl: string): RouteSnapshot | undefined {\r\n    let resolvedRoute: RouteSnapshot | undefined;\r\n    for (let route of childRoutes) {\r\n        resolvedRoute = resolveRoute_(routes, route, initialUrl);\r\n        if (resolvedRoute) {\r\n            return resolvedRoute;\r\n        }\r\n    }\r\n    return resolvedRoute;\r\n    // return childRoutes.reduce<RouteSnapshot | undefined>((p, route) => p || resolveRoute_(routes, route, initialUrl), undefined);\r\n}\r\nfunction resolveRoute_(routes: Routes, route: Route, initialUrl: string): RouteSnapshot | undefined {\r\n    // console.log('resolveRoute_', initialUrl);\r\n    let urlAfterRedirects!: string;\r\n    let extractedUrl: string = '';\r\n    let remainUrl: string = initialUrl;\r\n    const match: RegExpMatchArray | null = initialUrl.match(route.matcher);\r\n    // console.log(route.matcher, match?.length, initialUrl, '=>', route.path);\r\n    if (!match) {\r\n        return undefined;\r\n    }\r\n    if (route.redirectTo) {\r\n        // console.log('match', initialUrl, '=>', route.redirectTo, match);\r\n        return resolveRoutes_(routes, routes, route.redirectTo);\r\n    }/* else {\r\n        // console.log('match', initialUrl, match);\r\n    }*/\r\n    extractedUrl = match[0];\r\n    remainUrl = initialUrl.substring(match[0].length, initialUrl.length);\r\n    const routePath: RoutePath = new RoutePath(extractedUrl, route.segments, undefined, RouterService.locationStrategy);\r\n    let params: RouterKeyValue = routePath.params;\r\n    const snapshot: RouteSnapshot = new RouteSnapshot({ ...route, initialUrl, urlAfterRedirects, extractedUrl, remainUrl, params });\r\n    route.snapshot = snapshot;\r\n    if (route.children?.length && remainUrl.length) {\r\n        const childRoute: RouteSnapshot | undefined = resolveRoutes_(routes, route.children, remainUrl);\r\n        snapshot.childRoute = childRoute;\r\n        if (childRoute) {\r\n            childRoute.parent = snapshot;\r\n        }\r\n    }\r\n    // console.log('RouteSnapshot', snapshot.path, snapshot.extractedUrl, snapshot.remainUrl);\r\n    return snapshot;\r\n}\r\nfunction makeActivatorResponse$_(event: RouterEvent, activators: Observable<boolean | RouteComponent[]>[]): Observable<RouterEvent> {\r\n    // console.log('makeActivatorResponse$_', event);\r\n    return combineLatest(...activators).pipe(\r\n        map((values: (boolean | RouteComponent[])[]) => {\r\n            const canActivate: boolean | RouteComponent[] = values.reduce<boolean | RouteComponent[]>((p: boolean | RouteComponent[], c: boolean | RouteComponent[]) => {\r\n                return p === true ? (c === true ? true : c) : p;\r\n            }, true);\r\n            if (canActivate === true) {\r\n                return event;\r\n            } else {\r\n                const cancelEvent: IRouterEvent = { ...event, reason: 'An activation guard has dismissed navigation to the route.' };\r\n                if (canActivate !== false) {\r\n                    cancelEvent.redirectTo = canActivate;\r\n                }\r\n                return new NavigationCancel(cancelEvent);\r\n            }\r\n        })\r\n    );\r\n}\r\nfunction makeCanDeactivateResponse$_(events$: ReplaySubject<RouterEvent>, event: GuardsCheckStart, currentRoute?: RouteSnapshot): Observable<RouterEvent> {\r\n    // console.log('makeCanDeactivateResponse$_', event);\r\n    if (event.route.canDeactivate && event.route.canDeactivate.length && currentRoute?.instance) {\r\n        const route: RouteSnapshot = event.route;\r\n        return makeActivatorResponse$_(event, route.canDeactivate.map(x => x(currentRoute.instance!, currentRoute)));\r\n    } else {\r\n        return of(event);\r\n    }\r\n}\r\nfunction makeCanLoadResponse$_(events$: ReplaySubject<RouterEvent>, event: GuardsCheckStart): Observable<RouterEvent> {\r\n    // console.log('makeCanLoadResponse$_', event);\r\n    if (event.route.canLoad && event.route.canLoad.length) {\r\n        const route: RouteSnapshot = event.route;\r\n        return makeActivatorResponse$_(event, route.canLoad.map(x => x(route, route.segments)));\r\n    } else {\r\n        return of(event);\r\n    }\r\n}\r\nfunction makeCanActivateChildResponse$_(events$: ReplaySubject<RouterEvent>, event: GuardsCheckStart): Observable<RouterEvent> {\r\n    // console.log('makeCanActivateChildResponse$_', event, event.route.childRoute);\r\n    const reduceChildRouteActivators_ = (route: RouteSnapshot, activators: Observable<boolean | RouteComponent[]>[]): Observable<boolean | RouteComponent[]>[] => {\r\n        // console.log('reduceChildRouteActivators_', route.canActivateChild, route.childRoute);\r\n        while (route != null && route.canActivateChild && route.canActivateChild.length && route.childRoute) {\r\n            const routeActivators: Observable<boolean | RouteComponent[]>[] = route.canActivateChild.map(x => x(route.childRoute!));\r\n            Array.prototype.push.apply(activators, routeActivators);\r\n            route = route.childRoute;\r\n        }\r\n        return activators;\r\n    }\r\n    const activators: Observable<boolean | RouteComponent[]>[] = reduceChildRouteActivators_(event.route, []);\r\n    // console.log('makeCanActivateChildResponse$_', activators);\r\n    if (activators.length) {\r\n        return makeActivatorResponse$_(event, activators);\r\n    } else {\r\n        return of(event);\r\n    }\r\n}\r\nfunction makeCanActivateResponse$_(events$: ReplaySubject<RouterEvent>, event: ChildActivationStart): Observable<RouterEvent> {\r\n    // console.log('makeCanActivateResponse$_', event);\r\n    if (event.route.canActivate && event.route.canActivate.length) {\r\n        const route: RouteSnapshot = event.route;\r\n        return makeActivatorResponse$_(event, route.canActivate.map(x => x(route)));\r\n    } else {\r\n        return of(event);\r\n    }\r\n}\r\nfunction makeObserve$_(routes: Routes, route$: ReplaySubject<RouteSnapshot>, events$: ReplaySubject<RouterEvent>, locationStrategy: ILocationStrategy): Observable<RouterEvent> {\r\n    let currentRoute: RouteSnapshot | undefined;\r\n    const stateEvents$ = merge(fromEvent<PopStateEvent>(window, 'popstate')).pipe(\r\n        /*\r\n        tap((event: PopStateEvent) => {\r\n            // console.log('location', document.location.pathname, 'state', event.state);\r\n        }),\r\n        */\r\n        map(event => new NavigationStart({ routerLink: document.location.pathname, trigger: 'popstate' })),\r\n        shareReplay(1),\r\n    );\r\n    return merge(stateEvents$, events$).pipe(\r\n        switchMap((event: RouterEvent) => {\r\n            if (event instanceof GuardsCheckStart) {\r\n                return makeCanDeactivateResponse$_(events$, event, currentRoute).pipe(\r\n                    switchMap((nextEvent: RouterEvent) => {\r\n                        if (nextEvent instanceof NavigationCancel) {\r\n                            return of(nextEvent);\r\n                        } else {\r\n                            return makeCanLoadResponse$_(events$, event).pipe(\r\n                                switchMap((nextEvent: RouterEvent) => {\r\n                                    if (nextEvent instanceof NavigationCancel) {\r\n                                        return of(nextEvent);\r\n                                    } else {\r\n                                        return makeCanActivateChildResponse$_(events$, event);\r\n                                    }\r\n                                }),\r\n                            );\r\n                        }\r\n                    }),\r\n                );\r\n            } else if (event instanceof ChildActivationStart) {\r\n                return makeCanActivateResponse$_(events$, event);\r\n            } else {\r\n                return of(event);\r\n            }\r\n        }),\r\n        tap((event: RouterEvent) => {\r\n            if (event instanceof NavigationStart) {\r\n                // console.log('NavigationStart', event.routerLink);\r\n                const routerLink = event.routerLink;\r\n                // console.log('routerLink', routerLink);\r\n                let snapshot: RouteSnapshot | undefined;\r\n                let initialUrl: string;\r\n                const routePath: RoutePath = RouterService.getPath(routerLink);\r\n                // console.log(routePath, routePath.url);\r\n                initialUrl = routePath.url;\r\n                // console.log('initialUrl', initialUrl);\r\n                const isRelative: boolean = initialUrl.indexOf('/') !== 0;\r\n                if (isRelative && currentRoute && currentRoute.children?.length) {\r\n                    snapshot = resolveRoutes_(routes, currentRoute.children, initialUrl);\r\n                    if (snapshot) {\r\n                        currentRoute.childRoute = snapshot;\r\n                        snapshot.parent = currentRoute;\r\n                        snapshot = currentRoute;\r\n                    }\r\n                    // console.log('relative', currentRoute, snapshot, initialUrl);\r\n                } else {\r\n                    snapshot = resolveRoutes_(routes, routes, initialUrl);\r\n                    // console.log('absolute');\r\n                }\r\n                if (snapshot) {\r\n                    // console.log(routes);\r\n                    currentRoute = snapshot;\r\n                    events$.next(new RoutesRecognized({ ...event, route: snapshot }));\r\n                } else {\r\n                    events$.next(new NavigationError({ ...event, error: new Error('unknown route') }));\r\n                }\r\n            } else if (event instanceof RoutesRecognized) {\r\n                // console.log('RoutesRecognized', event);\r\n                events$.next(new GuardsCheckStart({ ...event }));\r\n            } else if (event instanceof GuardsCheckStart) {\r\n                // console.log('GuardsCheckStart', event);\r\n                events$.next(new ChildActivationStart({ ...event }));\r\n            } else if (event instanceof ChildActivationStart) {\r\n                // console.log('ChildActivationStart', event);\r\n                events$.next(new ActivationStart({ ...event }));\r\n            } else if (event instanceof ActivationStart) {\r\n                // console.log('ActivationStart', event);\r\n                events$.next(new GuardsCheckEnd({ ...event }));\r\n            } else if (event instanceof GuardsCheckEnd) {\r\n                // console.log('GuardsCheckEnd', event);\r\n                events$.next(new ResolveStart({ ...event }));\r\n            } else if (event instanceof ResolveStart) {\r\n                // console.log('ResolveStart', event);\r\n                events$.next(new ResolveEnd({ ...event }));\r\n            } else if (event instanceof ResolveEnd) {\r\n                // console.log('ResolveEnd', event);\r\n                events$.next(new ActivationEnd({ ...event }));\r\n            } else if (event instanceof ActivationEnd) {\r\n                // console.log('ActivationEnd', event);\r\n                events$.next(new ChildActivationEnd({ ...event }));\r\n            } else if (event instanceof ChildActivationEnd) {\r\n                // console.log('ChildActivationEnd', event);\r\n                events$.next(new RouteConfigLoadStart({ ...event }));\r\n            } else if (event instanceof RouteConfigLoadStart) {\r\n                // console.log('RouteConfigLoadStart', event);\r\n                events$.next(new RouteConfigLoadEnd({ ...event }));\r\n            } else if (event instanceof RouteConfigLoadEnd) {\r\n                // console.log('RouteConfigLoadEnd', event);\r\n                events$.next(new NavigationEnd({ ...event }));\r\n            } else if (event instanceof NavigationEnd) {\r\n                const segments: string[] = [];\r\n                let source: RouteSnapshot | undefined = event.route;\r\n                while (source != null) {\r\n                    // console.log(source.params, source.data);\r\n                    if (source.extractedUrl?.length) {\r\n                        segments.push(source.extractedUrl);\r\n                    }\r\n                    if (source.childRoute) {\r\n                        source = source.childRoute;\r\n                    } else {\r\n                        if (source.remainUrl?.length) {\r\n                            segments[segments.length - 1] = segments[segments.length - 1] + source.remainUrl;\r\n                        }\r\n                        source = undefined;\r\n                    }\r\n                }\r\n                const extractedUrl: string = segments.join('/').replace(/\\/\\//g, '/');\r\n                console.log('NavigationEnd', event);\r\n                clearRoutes_(routes, event.route);\r\n                locationStrategy.setHistory(extractedUrl, undefined, event.trigger === 'popstate');\r\n                // setHistory_(locationStrategy, extractedUrl, undefined, event.trigger === 'popstate');\r\n                route$.next(event.route);\r\n            } else if (event instanceof NavigationCancel) {\r\n                console.log('NavigationCancel', event);\r\n                if (event.redirectTo) {\r\n                    events$.next(new NavigationStart({ routerLink: event.redirectTo, trigger: 'imperative' }));\r\n                }\r\n            } else if (event instanceof NavigationError) {\r\n                console.log('NavigationError', event);\r\n            }\r\n        }),\r\n        catchError((error: Error) => of(new NavigationError({ ...event, error }))),\r\n        shareReplay(1),\r\n    );\r\n}\r\n","import { Directive, getContext, IFactoryMeta } from 'rxcomp';\r\nimport { fromEvent, Observable } from 'rxjs';\r\nimport { shareReplay, takeUntil } from 'rxjs/operators';\r\nimport { INavigationExtras } from '../route/route';\r\nimport { RoutePath } from '../route/route-path';\r\nimport { RouteSegment } from '../route/route-segment';\r\nimport { RouteComponent, RouterLink } from '../router.types';\r\nimport RouterService from './router.service';\r\n\r\nexport default class RouterLinkDirective extends Directive {\r\n    path!: RoutePath;\r\n    segments!: RouteSegment[];\r\n    private routerLink_!: RouteComponent[];\r\n    get routerLink(): RouterLink {\r\n        return this.routerLink_;\r\n    }\r\n    set routerLink(routerLink: RouterLink) {\r\n        this.routerLink_ = Array.isArray(routerLink) ? routerLink : [routerLink];\r\n        this.segments = this.getSegments(this.routerLink_);\r\n    }\r\n\r\n    getSegments(routerLink: RouteComponent[]): RouteSegment[] {\r\n        // console.log('RouterLinkDirective.getSegments', routerLink);\r\n        const segments: RouteSegment[] = [];\r\n        routerLink.forEach(item => {\r\n            if (typeof item === 'string') {\r\n                const regExp: RegExp = /([^:]+)|\\:([^\\/]+)/g;\r\n                const matches = item.matchAll(regExp);\r\n                const components = [];\r\n                for (let match of matches) {\r\n                    const g1 = match[1];\r\n                    const g2 = match[2];\r\n                    if (g1) {\r\n                        components.push(g1);\r\n                    } else if (g2) {\r\n                        const param: { [key: string]: any } = {};\r\n                        param[g2] = null;\r\n                        components.push(param);\r\n                    }\r\n                }\r\n            } else {\r\n                segments.push(new RouteSegment('', {}));\r\n            }\r\n        });\r\n        return segments;\r\n    }\r\n\r\n    onInit() {\r\n        const { node } = getContext(this);\r\n        const event$: Observable<Event> = fromEvent<Event>(node, 'click').pipe(shareReplay(1));\r\n        event$.pipe(\r\n            takeUntil(this.unsubscribe$)\r\n        ).subscribe(event => {\r\n            // console.log('RouterLinkDirective', event, this.routerLink);\r\n            // !!! skipLocationChange\r\n            const navigationExtras: INavigationExtras = {\r\n                skipLocationChange: this.skipLocationChange,\r\n                replaceUrl: this.replaceUrl,\r\n                state: this.state,\r\n            };\r\n            RouterService.setRouterLink(this.routerLink, navigationExtras);\r\n            event.preventDefault();\r\n            return false;\r\n        });\r\n    }\r\n\r\n    onChanges() {\r\n        const { node } = getContext(this);\r\n        const routePath: RoutePath = RouterService.getPath(this.routerLink_);\r\n        // console.log('RouterLinkDirective.routePath', routePath);\r\n        node.setAttribute('href', routePath.url);\r\n    }\r\n\r\n    static meta: IFactoryMeta = {\r\n        selector: '[routerLink],[[routerLink]]',\r\n        inputs: ['routerLink'],\r\n    };\r\n}\r\n\r\n/*\r\nget urlTree(): UrlTree {\r\n    return RouterService.createUrlTree(this.routerLink, {\r\n        relativeTo: this.route,\r\n        queryParams: this.queryParams,\r\n        fragment: this.fragment,\r\n        preserveQueryParams: this.preserve,\r\n        queryParamsHandling: this.queryParamsHandling,\r\n        preserveFragment: this.preserveFragment,\r\n    });\r\n}\r\n*/\r\n","import { Directive, getContext, IFactoryMeta } from 'rxcomp';\r\nimport { RoutePath } from '../route/route-path';\r\nimport RouterLinkDirective from './router-link.directive';\r\nimport RouterService from './router.service';\r\n\r\nexport default class RouterLinkActiveDirective extends Directive {\r\n    routerLinkActive!: { [key: string]: string } | string;\r\n    keys: string[] = [];\r\n    onChanges() {\r\n        // console.log('RouterLinkActive.onChanges');\r\n        const { node } = getContext(this);\r\n        node.classList.remove.apply(node.classList, this.keys);\r\n        let keys: string[] = [];\r\n        const active = this.isActive();\r\n        if (active) {\r\n            const object = this.routerLinkActive;\r\n            if (typeof object === 'object') {\r\n                for (let key in object) {\r\n                    if (object[key]) {\r\n                        keys.push(key);\r\n                    }\r\n                }\r\n            } else if (typeof object === 'string') {\r\n                keys = object.split(' ').filter(x => x.length);\r\n            }\r\n        }\r\n        node.classList.add.apply(node.classList, keys);\r\n        this.keys = keys;\r\n        // console.log('RouterLinkActive.onChanges', active, keys);\r\n    }\r\n    isActive(): boolean {\r\n        const path: RoutePath = RouterService.getPath(this.host.routerLink);\r\n        const isActive: boolean = path.route?.snapshot != null;\r\n        // console.log('RouterLinkActive.isActive', isActive);\r\n        return isActive;\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: '[routerLinkActive],[[routerLinkActive]]',\r\n        hosts: { host: RouterLinkDirective },\r\n        inputs: ['routerLinkActive'],\r\n    };\r\n}\r\n","import { Component, Factory, getContext, IComment, IElement, IFactoryMeta, Structure } from 'rxcomp';\r\nimport { isObservable, Observable, Observer, of, ReplaySubject, Subscription } from 'rxjs';\r\nimport { filter, switchMap, takeUntil, tap } from 'rxjs/operators';\r\nimport View from '../core/view';\r\nimport { isPromise } from '../route/route-activators';\r\nimport { RouteSnapshot } from '../route/route-snapshot';\r\nimport RouterService from './router.service';\r\n\r\nexport default class RouterOutletStructure extends Structure {\r\n    private route$_: ReplaySubject<RouteSnapshot | undefined> = new ReplaySubject<RouteSnapshot | undefined>(1);\r\n    private route_?: RouteSnapshot;\r\n    private factory_?: typeof Component;\r\n    get route(): RouteSnapshot | undefined {\r\n        return this.route_;\r\n    }\r\n    host?: RouterOutletStructure;\r\n    outlet!: IComment;\r\n    element?: IElement;\r\n    instance?: Component;\r\n    onInit() {\r\n        this.route$().pipe(\r\n            switchMap(snapshot => this.factory$(snapshot)),\r\n            takeUntil(this.unsubscribe$)\r\n        ).subscribe(() => {\r\n            // console.log(`RouterOutletStructure ActivatedRoutes: [\"${RouterService.flatRoutes.filter(x => x.snapshot).map(x => x.snapshot?.extractedUrl).join('\", \"')}\"]`);\r\n        });\r\n        if (this.host) {\r\n            this.route$_.next(this.host.route?.childRoute);\r\n        }\r\n    }\r\n    onChanges() {\r\n        if (this.host) {\r\n            this.route$_.next(this.host.route?.childRoute);\r\n        }\r\n    }\r\n    route$(): Observable<RouteSnapshot | undefined> {\r\n        const source: Observable<RouteSnapshot | undefined> = this.host ? this.route$_ : RouterService.route$;\r\n        return source.pipe(\r\n            filter((snapshot: RouteSnapshot | undefined) => {\r\n                this.route_ = snapshot; // !!!\r\n                if (this.snapshot_ && snapshot && this.snapshot_.component === snapshot.component) {\r\n                    this.snapshot_.next(snapshot);\r\n                    return false;\r\n                } else {\r\n                    this.snapshot_ = snapshot;\r\n                    return true;\r\n                }\r\n            }),\r\n        );\r\n    }\r\n    factory$(snapshot: RouteSnapshot | undefined): Observable<boolean> {\r\n        const { module, node } = getContext(this);\r\n        const factory: typeof Component | undefined = snapshot?.component;\r\n        if (this.factory_ !== factory) {\r\n            this.factory_ = factory;\r\n            return this.onExit$_(this.element, this.instance).pipe(\r\n                tap(() => {\r\n                    if (this.element) {\r\n                        this.element.parentNode!.removeChild(this.element);\r\n                        module.remove(this.element, this);\r\n                        this.element = undefined;\r\n                        this.instance = undefined;\r\n                    }\r\n                }),\r\n                switchMap(() => {\r\n                    if (snapshot && factory && factory.meta.template) {\r\n                        let element: IElement = document.createElement('div');\r\n                        element.innerHTML = factory.meta.template;\r\n                        if (element.children.length === 1) {\r\n                            element = element.firstElementChild as IElement;\r\n                        }\r\n                        node.appendChild(element);\r\n                        const instance: Factory | undefined = module.makeInstance(element, factory, factory.meta.selector!, this, undefined, { route: snapshot });\r\n                        module.compile(element, instance);\r\n                        this.instance = instance;\r\n                        this.element = element;\r\n                        snapshot.instance = instance;\r\n                        return this.onEnter$_(element, instance);\r\n                    } else {\r\n                        return of(false);\r\n                    }\r\n                })\r\n            );\r\n        } else {\r\n            return of(false);\r\n        }\r\n    }\r\n    private onEnter$_(element?: IElement, instance?: Component): Observable<boolean> {\r\n        if (element && instance && instance instanceof View) {\r\n            return asObservable_([element], instance.onEnter);\r\n        } else {\r\n            return of(true);\r\n        }\r\n    }\r\n    private onExit$_(element?: IElement, instance?: Component): Observable<boolean> {\r\n        if (element && instance && instance instanceof View) {\r\n            return asObservable_([element], instance.onExit);\r\n        } else {\r\n            return of(true);\r\n        }\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: 'router-outlet,[router-outlet]',\r\n        hosts: { host: RouterOutletStructure },\r\n    };\r\n}\r\n\r\nfunction asObservable_<T>(args: any[], callback: (...args: any[]) => Observable<T> | Promise<T> | (() => T) | T): Observable<T> {\r\n    return Observable.create(function (observer: Observer<T>) {\r\n        let subscription: Subscription;\r\n        try {\r\n            let result: Observable<T> | Promise<T> | (() => T) | T = callback(...args);\r\n            if (isObservable(result)) {\r\n                subscription = result.subscribe(result => {\r\n                    observer.next(result);\r\n                    observer.complete();\r\n                });\r\n            } else if (isPromise<T>(result)) {\r\n                (result as Promise<T>).then(result => {\r\n                    observer.next(result);\r\n                    observer.complete();\r\n                });\r\n            } else if (typeof result === 'function') {\r\n                observer.next((result as (() => T))() as T);\r\n                observer.complete();\r\n            } else {\r\n                observer.next(result);\r\n                observer.complete();\r\n            }\r\n        } catch (error) {\r\n            observer.error(error);\r\n        }\r\n        return () => {\r\n            if (subscription) {\r\n                subscription.unsubscribe();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/*\r\nset route(route: RouteSnapshot | undefined) {\r\n    if (this.route_ && route && this.route_.component === route.component) {\r\n        this.route_.next(route);\r\n    } else {\r\n        this.route_ = route;\r\n        if (route) {\r\n            this.factory = route.component;\r\n            route.instance = this.instance;\r\n        } else {\r\n            this.factory = undefined;\r\n        }\r\n    }\r\n}\r\nget factory(): typeof Component | undefined {\r\n    return this.factory_;\r\n}\r\nset factory(factory: typeof Component | undefined) {\r\n    const { module, node } = getContext(this);\r\n    if (this.factory_ !== factory) {\r\n        this.factory_ = factory;\r\n        if (this.element) {\r\n            if (this.instance && this.instance instanceof View) {\r\n                asObservable_([this.element], this.instance.onExit);\r\n            }\r\n            this.element.parentNode!.removeChild(this.element);\r\n            module.remove(this.element, this);\r\n            this.element = undefined;\r\n            this.instance = undefined;\r\n        }\r\n        if (factory && factory.meta.template) {\r\n            let element: IElement = document.createElement('div');\r\n            element.innerHTML = factory.meta.template;\r\n            if (element.children.length === 1) {\r\n                element = element.firstElementChild as IElement;\r\n            }\r\n            node.appendChild(element);\r\n            const instance: Factory | undefined = module.makeInstance(element, factory, factory.meta.selector!, this);\r\n            module.compile(element, instance);\r\n            this.instance = instance;\r\n            this.element = element;\r\n        }\r\n    }\r\n}\r\n*/","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\r\nimport { takeUntil, tap } from 'rxjs/operators';\r\nimport { LocationStrategy } from './location/location.strategy';\r\nimport { IRoute } from './route/route';\r\nimport { NavigationCancel, NavigationEnd, NavigationError, RouterEvent } from './router/router-events';\r\nimport RouterLinkActiveDirective from './router/router-link-active.directive';\r\nimport RouterLinkDirective from './router/router-link.directive';\r\nimport RouterOutletStructure from './router/router-outlet.structure';\r\nimport RouterService from './router/router.service';\r\n\r\nconst factories: typeof Factory[] = [\r\n\tRouterOutletStructure,\r\n\tRouterLinkDirective,\r\n\tRouterLinkActiveDirective,\r\n];\r\n\r\nconst pipes: typeof Pipe[] = [\r\n];\r\n\r\n/**\r\n *  RouterModule Class.\r\n * @example\r\n * export default class AppModule extends Module {}\r\n *\r\n * AppModule.meta = {\r\n *  imports: [\r\n *   CoreModule,\r\n *   RouterModule.forRoot([\r\n *    { path: '', redirectTo: '/index', pathMatch: 'full' },\r\n *    { path: 'index', component: IndexComponent, data: { title: 'Index' } }\r\n *   ])\r\n *  ],\r\n *  declarations: [\r\n *   IndexComponent\r\n *  ],\r\n *  bootstrap: AppComponent,\r\n * };\r\n * @extends Module\r\n */\r\nexport default class RouterModule extends Module {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t// console.log('RouterModule');\r\n\t\tRouterService.observe$.pipe(\r\n\t\t\ttap((event: RouterEvent) => {\r\n\t\t\t\tif (event instanceof NavigationEnd\r\n\t\t\t\t\t|| event instanceof NavigationCancel\r\n\t\t\t\t\t|| event instanceof NavigationError) {\r\n\t\t\t\t\tif (this.instances?.length) {\r\n\t\t\t\t\t\tconst root = this.instances[0];\r\n\t\t\t\t\t\troot.pushChanges();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe();\r\n\t\tRouterService.navigate(`${window.location.pathname}${window.location.search}${window.location.hash}`);\r\n\t}\r\n\r\n\tstatic meta: IModuleMeta = {\r\n\t\tdeclarations: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t],\r\n\t\texports: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t]\r\n\t};\r\n\r\n\tstatic forRoot(routes: IRoute[]): typeof RouterModule {\r\n\t\tRouterService.setRoutes(routes);\r\n\t\treturn RouterModule;\r\n\t}\r\n\r\n\tstatic useStrategy(locationStrategyType: typeof LocationStrategy): typeof RouterModule {\r\n\t\tRouterService.useLocationStrategy(locationStrategyType);\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nexport enum RouteLocationStrategy {\r\n    Path = 'path',\r\n    Hash = 'hash',\r\n}\r\nexport type RouteComponent = string | number | { [key: string]: any; };\r\nexport type RouterLink = string | RouteComponent[];\r\nexport type RouterActivator = Observable<boolean> | (() => boolean) | boolean;\r\nexport type RouterActivatorResult = Observable<boolean | RouteComponent[]> | Promise<boolean | RouteComponent[]> | boolean | RouteComponent[];\r\nexport type RouterKeyValue = { [key: string]: RouterKeyValue | string | null };\r\nexport type Params = { [key: string]: any; };\r\nexport type Data = { [key: string]: any; };\r\n\r\n","import { isPlatformBrowser } from 'rxcomp';\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nexport function transition$(callback: (complete: (result: boolean) => void) => void) {\r\n    return Observable.create(function (observer: Observer<boolean>) {\r\n        // let subscription: Subscription;\r\n        try {\r\n            if (isPlatformBrowser) {\r\n                callback((result: boolean) => {\r\n                    observer.next(result);\r\n                    observer.complete();\r\n                });\r\n            } else {\r\n                observer.next(true);\r\n                observer.complete();\r\n            }\r\n        } catch (error) {\r\n            observer.error(error);\r\n        }\r\n        /*\r\n        return () => {\r\n            if (subscription) {\r\n                subscription.unsubscribe();\r\n            }\r\n        }\r\n        */\r\n    });\r\n}","import { Component, errors$, getContext, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\nexport default class AppComponent extends Component {\r\n\terror: any = null;\r\n\r\n\tonInit() {\r\n\t\t// console.log('AppComponent.onInit', this);\r\n\t\tconst { node } = getContext(this);\r\n\t\tnode.classList.add('init');\r\n\t\terrors$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe(error => {\r\n\t\t\tthis.error = error;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: '[app-component]',\r\n\t};\r\n}\r\n","import { Component } from 'rxcomp';\r\nimport { ICanActivate, ICanActivateChild, ICanDeactivate, ICanLoad, RouterActivatorResult, RouteSegment, RouteSnapshot } from '../../../../src/rxcomp-router';\r\n\r\nexport class CustomActivator implements ICanActivate, ICanDeactivate<Component>, ICanActivateChild, ICanLoad {\r\n    canDeactivate<T>(component: T, currentRoute: RouteSnapshot): RouterActivatorResult {\r\n        // console.log('canDeactivate', component, currentRoute);\r\n        return true;\r\n    }\r\n    canLoad(route: RouteSnapshot, segments: RouteSegment[]): RouterActivatorResult {\r\n        // console.log('canLoad', route, segments);\r\n        return true;\r\n    }\r\n    canActivate(route: RouteSnapshot): RouterActivatorResult {\r\n        // console.log('canActivate', route);\r\n        return ['/dashboard'];\r\n    }\r\n    canActivateChild(childRoute: RouteSnapshot): RouterActivatorResult {\r\n        // console.log('canActivateChild', childRoute);\r\n        return childRoute.path === 'media' ? ['files'] : true;\r\n    }\r\n}\r\n\r\nexport const customActivator: CustomActivator = new CustomActivator();\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RouterKeyValue, RouterOutletStructure } from '../../../../src/rxcomp-router';\r\n\r\nexport default class ContactsComponent extends Component {\r\n    host!: RouterOutletStructure;\r\n    onInit() {\r\n        const route = this.host.route;\r\n        if (route) {\r\n            route.data$.pipe(\r\n                takeUntil(this.unsubscribe$)\r\n            ).subscribe((data: RouterKeyValue) => {\r\n                this.title = data.title;\r\n                // this.pushChanges(); // !!not needed;\r\n                // console.log('ContactsComponent', data);\r\n            });\r\n        }\r\n    }\r\n\r\n    static meta: IFactoryMeta = {\r\n        selector: '[contacts-component]',\r\n        hosts: { host: RouterOutletStructure },\r\n        template: /* html */`\r\n        <div class=\"page-contacts\">\r\n            <div class=\"title\">{{title}}</div>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { combineLatest } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RouterKeyValue, RouterOutletStructure } from '../../../../src/rxcomp-router';\r\n\r\nexport default class DataComponent extends Component {\r\n    host!: RouterOutletStructure;\r\n    onInit() {\r\n        const route = this.host.route;\r\n        if (route) {\r\n            combineLatest(route.data$, route.params$).pipe(\r\n                takeUntil(this.unsubscribe$)\r\n            ).subscribe((datas: RouterKeyValue[]) => {\r\n                this.title = datas[0].title;\r\n                this.params = datas[1];\r\n                // this.pushChanges(); // !!not needed;\r\n                // console.log('DataComponent', datas);\r\n            });\r\n        }\r\n        /*\r\n        this.host.route?.data$.pipe(\r\n            takeUntil(this.unsubscribe$),\r\n        ).subscribe((data) => this.title = data.title);\r\n        this.host.route?.params$.pipe(\r\n            takeUntil(this.unsubscribe$),\r\n        ).subscribe((params) => this.params = params);\r\n        */\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: '[data-component]',\r\n        hosts: { host: RouterOutletStructure },\r\n        template: /* html */`\r\n        <div class=\"page-data\">\r\n            <div class=\"title\">{{title}}</div>\r\n            <div class=\"params\">{{params | json}}</div>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import 'gsap';\r\nimport { IElement, IFactoryMeta } from 'rxcomp';\r\nimport { combineLatest } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RouterKeyValue, transition$, View } from '../../../../src/rxcomp-router';\r\n\r\nexport default class DetailComponent extends View {\r\n    onInit() {\r\n        console.log('DetailComponent.onInit', this.route);\r\n        combineLatest(this.route.data$, this.route.params$).pipe(\r\n            takeUntil(this.unsubscribe$)\r\n        ).subscribe((datas: RouterKeyValue[]) => {\r\n            this.title = datas[0].title;\r\n            this.detailId = datas[1].detailId;\r\n            // this.pushChanges(); // !!not needed;\r\n            // console.log('DetailComponent', datas);\r\n        });\r\n    }\r\n    onEnter(node: IElement) {\r\n        return transition$(complete => {\r\n            gsap.set(node, { opacity: 0 });\r\n            gsap.to(node, {\r\n                opacity: 1,\r\n                duration: 1,\r\n                ease: Power3.easeInOut,\r\n                onComplete: () => {\r\n                    complete(true);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    onExit(node: IElement) {\r\n        return transition$(complete => {\r\n            gsap.set(node, { opacity: 1 });\r\n            gsap.to(node, {\r\n                opacity: 0,\r\n                duration: 1,\r\n                ease: Power3.easeInOut,\r\n                onComplete: () => {\r\n                    complete(true);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: '[detail-component]',\r\n        template: /* html */`\r\n        <div class=\"page-detail\">\r\n            <div class=\"title\">Detail {{detailId}}</div>\r\n            <ul class=\"nav--menu\">\r\n                <li><a routerLink=\"media\" routerLinkActive=\"active\">Media</a></li>\r\n                <li><a routerLink=\"files\" routerLinkActive=\"active\">Files</a></li>\r\n            </ul>\r\n            <router-outlet></router-outlet>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RouterKeyValue, RouterOutletStructure } from '../../../../src/rxcomp-router';\r\n\r\nexport default class IndexComponent extends Component {\r\n    host!: RouterOutletStructure;\r\n    onInit() {\r\n        const route = this.host.route;\r\n        if (route) {\r\n            route.data$.pipe(\r\n                takeUntil(this.unsubscribe$)\r\n            ).subscribe((data: RouterKeyValue) => {\r\n                this.title = data.title;\r\n                // this.pushChanges(); // !!not needed;\r\n                // console.log('IndexComponent', data);\r\n            });\r\n        }\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: '[index-component]',\r\n        hosts: { host: RouterOutletStructure },\r\n        template: /* html */`\r\n        <div class=\"page-index\">\r\n            <div class=\"title\">{{title}}</div>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { RouterOutletStructure } from '../../../../src/rxcomp-router';\r\n\r\nexport default class NotFoundComponent extends Component {\r\n    host!: RouterOutletStructure;\r\n    onInit() {\r\n        // console.log('NotFoundComponent.onInit');\r\n    }\r\n\r\n    static meta: IFactoryMeta = {\r\n        selector: '[not-found-component]',\r\n        template: /* html */`\r\n        <div class=\"page-not-found\">\r\n            <div class=\"title\">Not Found</div>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { RouterKeyValue, RouterOutletStructure } from '../../../../src/rxcomp-router';\r\n\r\nexport default class SubComponent extends Component {\r\n    host!: RouterOutletStructure;\r\n    onInit() {\r\n        const route = this.host.route;\r\n        if (route) {\r\n            route.data$.pipe(\r\n                takeUntil(this.unsubscribe$)\r\n            ).subscribe((data: RouterKeyValue) => {\r\n                this.title = data.title;\r\n                // this.pushChanges(); // !!not needed;\r\n                // console.log('SubComponent', data);\r\n            });\r\n        }\r\n    }\r\n    static meta: IFactoryMeta = {\r\n        selector: '[sub-component]',\r\n        hosts: { host: RouterOutletStructure },\r\n        template: /* html */`\r\n        <div class=\"page-sub\">\r\n            <div class=\"title\">{{title}}</div>\r\n        </div>\r\n        `,\r\n    };\r\n}\r\n","import { CoreModule, IModuleMeta, Module } from 'rxcomp';\r\nimport { LocationStrategyHash, RouterModule } from '../../../src/rxcomp-router';\r\nimport AppComponent from './app.component';\r\nimport { customActivator } from './custom-activator/custom-activator';\r\nimport ContactsComponent from './pages/contacts.component';\r\nimport DataComponent from './pages/data.component';\r\nimport DetailComponent from './pages/detail.component';\r\nimport IndexComponent from './pages/index.component';\r\nimport NotFoundComponent from './pages/not-found.component';\r\nimport SubComponent from './pages/sub.component';\r\n\r\nexport default class AppModule extends Module {\r\n\tstatic meta: IModuleMeta = {\r\n\t\timports: [\r\n\t\t\tCoreModule,\r\n\t\t\tRouterModule.forRoot([\r\n\t\t\t\t{ path: '', redirectTo: '/dashboard', pathMatch: 'full' },\r\n\t\t\t\t{ path: 'dashboard', component: IndexComponent, data: { title: 'Dashboard' } },\r\n\t\t\t\t{\r\n\t\t\t\t\tpath: 'detail/:detailId', component: DetailComponent, data: { title: 'Detail' },\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{ path: 'media', component: SubComponent, data: { title: 'Media' } },\r\n\t\t\t\t\t\t{ path: 'files', component: SubComponent, data: { title: 'Files' } }\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanActivateChild: [customActivator],\r\n\t\t\t\t},\r\n\t\t\t\t{ path: 'data/:data', component: DataComponent, data: { title: 'Data' } },\r\n\t\t\t\t{ path: 'contacts', component: ContactsComponent, data: { title: 'Contacts' }, canActivate: [customActivator] },\r\n\t\t\t\t{ path: '**', component: NotFoundComponent },\r\n\t\t\t]).useStrategy(LocationStrategyHash),\r\n\t\t],\r\n\t\tdeclarations: [\r\n\t\t\tIndexComponent,\r\n\t\t\tDataComponent,\r\n\t\t\tDetailComponent,\r\n\t\t\tContactsComponent,\r\n\t\t],\r\n\t\tbootstrap: AppComponent,\r\n\t};\r\n\r\n}\r\n","import { Browser } from 'rxcomp';\r\nimport AppModule from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}